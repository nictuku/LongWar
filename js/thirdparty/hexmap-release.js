var Helper={arrays:{addElement:function(b,a){b.push(a)},removeElement:function(d,b,c){c=typeof c!="undefined"?c:false;var a=d.length;while(a--){if(d[a]===b){d.splice(a,1);if(c){return}}}},contains:function(c,b){var a=c.length;while(a--){if(c[a]===b){return true}}return false}},objects:{defineGetter:function(a,c,b){if(Object.defineProperty){return Object.defineProperty(a,c,{get:b,configurable:true,enumerable:true})}if(Object.prototype.__defineGetter__){return a.__defineGetter__(c,b)}},defineSetter:function(b,c,a){if(Object.defineProperty){return Object.defineProperty(b,c,{set:a,configurable:true,enumerable:true})}if(Object.prototype.__defineSetter__){return b.__defineSetter__(c,a)}},defineAccessors:function(b,d,c,a){this.defineGetter(b,d,c);this.defineSetter(b,d,a)}}};Crafty.c("HexmapNode",{_i:0,_j:0,_parentNode:null,_G:0,_H:0,init:function(){Helper.objects.defineAccessors(this,"i",function(){return this._i},function(a){this._i=a});Helper.objects.defineAccessors(this,"j",function(){return this._j},function(a){this._j=a});Helper.objects.defineAccessors(this,"parentNode",function(){return this._parentNode},function(a){this._parentNode=a});Helper.objects.defineAccessors(this,"G",function(){return this._G},function(a){this._G=a});Helper.objects.defineAccessors(this,"H",function(){return this._H},function(a){this._H=a});Helper.objects.defineGetter(this,"F",function(){return this._G+this._H})},hexmapNode:function(b,a){this._i=b;this._j=a;return this}});Crafty.c("Hexmap",{_mapWidth:0,_mapHeight:0,_tiles:new Array(),_tileMeta:{_width:0,_height:0,_r:0,_s:0,_h:0},init:function(){},hexmap:function(b,a){this._tileMeta._width=b;this._tileMeta._height=a;this._tileMeta._r=this._tileMeta._width*0.5;this._tileMeta._s=this._tileMeta._r/Math.cos(20*(Math.PI/180));this._tileMeta._h=(this._tileMeta._height-this._tileMeta._s)*0.5;return this},setTile:function(b,a,c){if(b>=this._mapWidth||b<0||a>=this._mapHeight||a<0){return}this._tiles[(a*this._mapHeight)+b]=c},getTile:function(b,a){if(b>=this._mapWidth||b<0||a>=this._mapHeight||a<0){return null}return this._tiles[(a*this._mapHeight)+b]},getAdjacentTiles:function(c,b){var a=new Array();if(this.getTile(c+1,b)){a.push(this.getTile(c+1,b))}if(this.getTile(c-1,b)){a.push(this.getTile(c-1,b))}if(this.getTile(c,b-1)){a.push(this.getTile(c,b-1))}if(this.getTile(c,b+1)){a.push(this.getTile(c,b+1))}if(b%2!=0){if(this.getTile(c-1,b-1)){a.push(this.getTile(c-1,b-1))}if(this.getTile(c-1,b+1)){a.push(this.getTile(c-1,b+1))}}else{if(this.getTile(c+1,b-1)){a.push(this.getTile(c+1,b-1))}if(this.getTile(c+1,b+1)){a.push(this.getTile(c+1,b+1))}}return a},placeTile:function(b,a,c){c.x=b*2*this._tileMeta._r+((a%2==0)*this._tileMeta._r);c.y=a*(this._tileMeta._h+this._tileMeta._s);c.areaMap([this._tileMeta._width*0.5,0],[this._tileMeta._width,this._tileMeta._height*0.25],[this._tileMeta._width,this._tileMeta._height*0.75],[this._tileMeta._width*0.5,this._tileMeta._height],[0,this._tileMeta._height*0.75],[0,this._tileMeta._height*0.25]);return this},create:function(a,c,b){this._mapWidth=a;this._mapHeight=c;for(j=0;j<this._mapHeight;j++){for(i=0;i<this._mapWidth;i++){tile=b();tile.addComponent("HexmapNode").hexmapNode(i,j);this.placeTile(i,j,tile).setTile(i,j,tile)}}},findPath:function(a,f){var e=new Array();var b=new Array();var d=new Array();var c=function(k,h){dx=h.x-k.x;dy=h.y-k.y;return dx*dx+dy*dy};a.G=100;a.parentNode=null;b.push(a);while(true){var g=null;b.forEach(function(h){if(g==null){g=h}else{if(h!=null){h.H=c(h,f);g.H=c(g,f);if(h.F<g.F){g=h}}}});if(g==f||g==null){break}Helper.arrays.removeElement(b,g);Helper.arrays.addElement(d,g);this.getAdjacentTiles(g.i,g.j).forEach(function(h){if(h!=null){if(Helper.arrays.contains(d,h)){}else{if(!Helper.arrays.contains(b,h)){Helper.arrays.addElement(b,h);h.parentNode=g;h.G=g.G+100;h.H=c(h,f)}else{if(Helper.arrays.contains(b,h)&&h.G<g.G){h.parentNode=g;h.G=g.G+100;h.H=c(h,f)}}}}})}while(g.parentNode!=null){e.push(g);g=g._parentNode}return e}});